# Configuration serveur
# Note: http_listen_port sera override par boot.sh avec $PORT de Scalingo
server:
  http_listen_port: <%= server_config["http_listen_port"] %>
  grpc_listen_port: <%= server_config["grpc_listen_port"] %>

# Configuration du distributeur
distributor:
  receivers:
    otlp:
      protocols:
        grpc:
          endpoint: "0.0.0.0:4317"
        http:
          endpoint: "0.0.0.0:4318"

# Configuration de l'ingester
ingester:
  max_block_duration: <%= get_env("TEMPO_INGESTER_MAX_BLOCK_DURATION", "1h") %>
  max_block_bytes: <%= get_env("TEMPO_INGESTER_MAX_BLOCK_BYTES", "104857600") %>
  complete_block_timeout: <%= get_env("TEMPO_INGESTER_COMPLETE_BLOCK_TIMEOUT", "5m") %>

# Configuration du compacteur
compactor:
  compaction:
    block_retention: <%= get_env("TEMPO_COMPACTOR_BLOCK_RETENTION", "48h") %>

# Configuration du stockage
storage:
  trace:
    backend: <%= storage_config["trace"]["backend"] %>
  wal:
    path: <%= storage_config["wal"]["path"] %>
<% if storage_config["local"] %>
  local:
    path: <%= storage_config["local"]["path"] %>
<% end %>
<% if storage_config["s3"] %>
  s3:
    bucket: <%= storage_config["s3"]["bucket"] %>
    endpoint: <%= storage_config["s3"]["endpoint"] %>
    access_key_id: <%= ENV["TEMPO_STORAGE_S3_ACCESS_KEY_ID"] %>
    secret_access_key: <%= ENV["TEMPO_STORAGE_S3_SECRET_ACCESS_KEY"] %>
    insecure: <%= ENV["TEMPO_STORAGE_S3_INSECURE"] == "true" %>
<% end %>

# Configuration des m√©triques (optionnel)
metrics_generator:
  registry:
      source: tempo
      environment: <%= get_env("ENVIRONMENT", "production") %>